{"version":3,"file":"component---src-pages-login-tsx-e846d3e05fb40851db39.js","mappings":"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","sources":["webpack://gatsby-starter-minimal-ts/./src/database/routerViteGatsbyUniversal.ts","webpack://gatsby-starter-minimal-ts/./src/pages/login.tsx","webpack://gatsby-starter-minimal-ts/./src/database/useSupabaseIsLoggedIn.tsx","webpack://gatsby-starter-minimal-ts/./src/components/templates/DefaultLoginTemplate.tsx"],"sourcesContent":["// @ppm-template:role-based-auth\n// @ppm-version:2.0 // (was throwing error in gatsby)\n\nimport { useEffect, useRef } from \"react\";\n\ntype RouteList = any[];\n\nexport function useUniversalRouter() {\n  const routesRef = useRef<RouteList | null>(null);\n  const gatsbyNavigateRef = useRef<((to: string) => void) | null>(null);\n  const initializedRef = useRef(false);\n\n  useEffect(() => {\n    if (initializedRef.current || typeof window === \"undefined\") return;\n    initializedRef.current = true;\n\n    (async () => {\n      // ---------- 1) GATSBY DETECTION ----------\n      try {\n        const gatsbyModuleName = \"gatsby\";\n        // eslint-disable-next-line no-eval\n        const gatsby = await eval(`import(${JSON.stringify(gatsbyModuleName)})`);\n\n        if (typeof gatsby.navigate === \"function\") {\n          gatsbyNavigateRef.current = gatsby.navigate;\n          return; // <-- IMPORTANT: stop here in Gatsby\n        }\n      } catch {\n        // not Gatsby, keep going\n      }\n\n      // ---------- 2) VITE ONLY (hidden from Gatsby’s brain) ----------\n      const isVite =\n        // @ts-ignore\n        typeof window !== \"undefined\" &&\n        !!(window as any).__vite_plugin_react_preamble_installed__;\n\n      if (!isVite) return; // Gatsby exits cleanly here\n\n      try {\n        const virtualName = \"virtual:\" + \"generated-pages-react\";\n        // eslint-disable-next-line no-eval\n        const mod = await eval(`import(${JSON.stringify(virtualName)})`);\n        routesRef.current = mod.default;\n      } catch {\n        // truly not Vite, nothing to do\n      }\n    })();\n  }, []);\n\n  const go = (to: string) => {\n    if (gatsbyNavigateRef.current) {\n      gatsbyNavigateRef.current(to);\n      return;\n    }\n    window.location.assign(to);\n  };\n\n  const getRoutes = () => routesRef.current;\n\n  return { go, getRoutes };\n}","import React, { useState, useEffect } from \"react\";\nimport DefaultLoginTemplate from \"../components/templates/DefaultLoginTemplate\";\nimport { supabase } from \"../database/supabase\";\nimport { useUniversalRouter } from \"../database/routerViteGatsbyUniversal\";\nimport { useIsLoggedIn } from \"../database/useSupabaseIsLoggedIn\";\n\nconst LoginPage = () => {\n  const [email, setEmail] = useState(\"\");\n  const [password, setPassword] = useState(\"\");\n\n  // UI loading state (spinner)\n  const [loading, setLoading] = useState(false);\n\n  const [error, setError] = useState<string | null>(null);\n\n  const { go } = useUniversalRouter();\n\n  // Rename this so it doesn’t nuke your spinner\n  const { isLoggedIn, loading: authChecking } = useIsLoggedIn();\n\n  // If already logged in, bounce to CMS\n  useEffect(() => {\n    if (!authChecking && isLoggedIn) {\n      console.log(\"[Auth] Already logged in → redirecting to /cms\");\n      go(\"/cms\");\n    }\n  }, [authChecking, isLoggedIn]);\n\n  const handleLogin = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setLoading(true);\n    setError(null);\n\n    console.log(\"[Auth] Attempting login with:\", email);\n\n    try {\n      const { data, error } = await supabase.auth.signInWithPassword({\n        email,\n        password,\n      });\n\n      console.log(\"[Auth] Supabase result:\", data, error);\n\n      if (error) {\n        setError(error.message);\n        return;\n      }\n\n      console.log(\"[Auth] Login successful via Supabase\");\n      go(\"/cms\");\n\n    } catch (err: any) {\n      console.error(\"[Auth] Unexpected error:\", err);\n      setError(\"Something broke in Supabase. Check console.\");\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <DefaultLoginTemplate\n      email={email}\n      password={password}\n      onEmailChange={setEmail}\n      onPasswordChange={setPassword}\n      onSubmit={handleLogin}\n      loading={loading}\n      error={error}\n    />\n  );\n};\n\nexport default LoginPage;","import { useEffect, useState } from \"react\"\nimport { supabase } from \"./supabase\"\n\n/**\n * useIsLoggedIn Hook\n * Returns: { isLoggedIn, loading }\n * - Minimal version of useAuth\n * - Tracks only the login state (boolean)\n**/\n\n\nexport function useIsLoggedIn() {\n  const [isLoggedIn, setIsLoggedIn] = useState(false)\n  const [loading, setLoading] = useState(true)\n\n  useEffect(() => {\n    let isMounted = true\n\n    const loadSession = async () => {\n      const { data } = await supabase.auth.getSession()\n      if (!isMounted) return\n\n      setIsLoggedIn(!!data.session)\n      setLoading(false)\n    }\n\n    loadSession()\n\n    // Listen for auth state changes\n    const { data: listener } = supabase.auth.onAuthStateChange((_event, session) => {\n      if (!isMounted) return\n      setIsLoggedIn(!!session)\n    })\n\n    return () => {\n      isMounted = false\n      listener.subscription.unsubscribe()\n    }\n  }, [])\n\n  return { isLoggedIn, loading }\n}\n","import React from \"react\";\nimport \"./DefaultLoginTemplate.css\";\n\nexport interface DefaultLoginTemplateProps {\n    email: string;\n    password: string;\n    onEmailChange: (value: string) => void;\n    onPasswordChange: (value: string) => void;\n    onSubmit: (e: React.FormEvent) => void;\n    loading: boolean;\n    error: string | null;\n}\n\nconst DefaultLoginTemplate: React.FC<DefaultLoginTemplateProps> = ({\n    email,\n    password,\n    onEmailChange,\n    onPasswordChange,\n    onSubmit,\n    loading,\n    error,\n}) => {\n    return (\n        <div className=\"login-wrapper\">\n            <div className=\"login-card\">\n                <div className=\"login-header\">\n                    <div className=\"login-logo\">\n                        <svg\n                            width=\"32\"\n                            height=\"32\"\n                            viewBox=\"0 0 24 24\"\n                            fill=\"none\"\n                            stroke=\"currentColor\"\n                            strokeWidth=\"2.5\"\n                            strokeLinecap=\"round\"\n                            strokeLinejoin=\"round\"\n                        >\n                            <path d=\"M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5\" />\n                        </svg>\n                    </div>\n                    <h1 className=\"login-title\">Admin Portal</h1>\n                    <p className=\"login-subtitle\">Please enter your credentials to log in.</p>\n                </div>\n\n                {error && (\n                    <div className=\"login-error\">\n                        <svg\n                            width=\"16\"\n                            height=\"16\"\n                            viewBox=\"0 0 24 24\"\n                            fill=\"none\"\n                            stroke=\"currentColor\"\n                            strokeWidth=\"2\"\n                            strokeLinecap=\"round\"\n                            strokeLinejoin=\"round\"\n                        >\n                            <circle cx=\"12\" cy=\"12\" r=\"10\" />\n                            <line x1=\"12\" y1=\"8\" x2=\"12\" y2=\"12\" />\n                            <line x1=\"12\" y1=\"16\" x2=\"12.01\" y2=\"16\" />\n                        </svg>\n                        {error}\n                    </div>\n                )}\n\n                <form onSubmit={onSubmit} className=\"login-form\">\n                    <div className=\"form-group\">\n                        <label className=\"form-label\">Email Address</label>\n                        <div className=\"input-container\">\n                            <input\n                                type=\"email\"\n                                className=\"login-input\"\n                                placeholder=\"admin@example.com\"\n                                value={email}\n                                onChange={(e) => onEmailChange(e.target.value)}\n                                disabled={loading}\n                                required\n                            />\n                        </div>\n                    </div>\n\n                    <div className=\"form-group\">\n                        <label className=\"form-label\">Password</label>\n                        <div className=\"input-container\">\n                            <input\n                                type=\"password\"\n                                className=\"login-input\"\n                                placeholder=\"••••••••\"\n                                value={password}\n                                onChange={(e) => onPasswordChange(e.target.value)}\n                                disabled={loading}\n                                required\n                            />\n                        </div>\n                    </div>\n\n                    <div className=\"forgot-password\">\n                        <a href=\"/reset-password\" className=\"forgot-password-link\">\n                            Forgot password?\n                        </a>\n                    </div>\n\n                    <button type=\"submit\" className=\"login-button\" disabled={loading}>\n                        {loading ? (\n                            <div className=\"loading-dots\">\n                                <span></span>\n                                <span></span>\n                                <span></span>\n                            </div>\n                        ) : (\n                            \"Log In\"\n                        )}\n                    </button>\n                </form>\n\n                <div className=\"login-footer\">\n                    <p>© 2026 CMS Admin. All rights reserved.</p>\n                </div>\n            </div>\n        </div>\n    );\n};\n\nexport default DefaultLoginTemplate;\n"],"names":["useUniversalRouter","routesRef","useRef","gatsbyNavigateRef","initializedRef","useEffect","current","window","gatsbyModuleName","gatsby","eval","JSON","stringify","navigate","_unused","isVite","__vite_plugin_react_preamble_installed__","virtualName","mod","default","_unused2","go","to","location","assign","getRoutes","LoginPage","email","setEmail","useState","password","setPassword","loading","setLoading","error","setError","isLoggedIn","authChecking","useIsLoggedIn","console","log","React","DefaultLoginTemplate","onEmailChange","onPasswordChange","onSubmit","async","e","preventDefault","data","supabase","auth","signInWithPassword","message","err","setIsLoggedIn","isMounted","getSession","session","loadSession","listener","onAuthStateChange","_event","subscription","unsubscribe","_ref","className","width","height","viewBox","fill","stroke","strokeWidth","strokeLinecap","strokeLinejoin","d","cx","cy","r","x1","y1","x2","y2","type","placeholder","value","onChange","target","disabled","required","href"],"sourceRoot":""}