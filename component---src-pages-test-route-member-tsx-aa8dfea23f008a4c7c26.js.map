{"version":3,"file":"component---src-pages-test-route-member-tsx-aa8dfea23f008a4c7c26.js","mappings":"4OAMA,cAAqBA,EAAAA,cAAAA,EAAAA,SAAA,KAGjBA,EAAAA,cAACC,EAAAA,EAAa,CAACC,KAAK,QAAQC,SAAS,uBAAuB,iB,0PCFzD,SAASC,qBACd,MAAMC,WAAYC,EAAAA,mCAAAA,QAAyB,MACrCC,mBAAoBD,EAAAA,mCAAAA,QAAsC,MAC1DE,gBAAiBF,EAAAA,mCAAAA,SAAO,IAE9BG,EAAAA,mCAAAA,WAAU,KACJD,eAAeE,SAA6B,oBAAXC,SACrCH,eAAeE,SAAU,EAEzB,WAEE,IACE,MAAME,iBAAmB,SAEnBC,aAAeC,KAAK,UAAUC,KAAKC,UAAUJ,kBAAiB,KAEpE,GAA+B,mBAApBC,OAAOI,SAEhB,YADAV,kBAAkBG,QAAUG,OAAOI,SAGvC,CAAE,MAAAC,SACA,CAIF,MAAMC,OAEc,oBAAXR,UACJA,OAAeS,yCAEpB,GAAKD,OAEL,IACE,MAAME,YAAc,gCAEdC,UAAYR,KAAK,UAAUC,KAAKC,UAAUK,aAAY,KAC5DhB,UAAUK,QAAUY,IAAIC,OAC1B,CAAE,MAAAC,UACA,CAEH,EA/BD,KAgCC,IAEH,MAAMC,GAAMC,IACNnB,kBAAkBG,QACpBH,kBAAkBG,QAAQgB,GAG5Bf,OAAOgB,SAASC,OAAOF,IAGnBG,UAAYA,IAAMxB,UAAUK,QAElC,MAAO,CAAEe,MAAII,oBACf,C,+HCjDe,SAAS5B,EAAa6B,GAA6B,IAADC,EAAA,IAA3B,KAAE7B,EAAI,SAAE8B,GAAiBF,EAC7D,MAAM,EAACG,EAAQ,EAACC,IAAcC,EAAAA,EAAAA,UAAc,OACtC,EAACC,EAAQ,EAACC,IAAcF,EAAAA,EAAAA,WAAS,IAEjC,GAAEV,IAAOrB,EAAAA,EAAAA,KA2Bf,IAzBAK,EAAAA,EAAAA,WAAU,KACR,IAAI6B,GAAU,EAGdC,EAAAA,GAASC,KAAKC,aAAaC,KAAKC,IAAe,IAAd,KAAEC,GAAMD,EAClCL,IACLJ,EAAWU,EAAKX,SAChBI,GAAW,MAIb,MACEO,MAAM,aAAEC,IACNN,EAAAA,GAASC,KAAKM,kBAAkB,CAACC,EAAQd,KACtCK,GACLJ,EAAWD,KAGb,MAAO,KACLK,GAAU,EACVO,EAAaG,gBAEd,IAGCZ,EAAS,OAAO,KAGpB,GAAKH,UAAAA,EAASgB,KAEZ,OADAxB,EAAG,UACI,KAKT,OAF0C,QAA5BM,EAAGE,EAAQgB,KAAKC,oBAAY,IAAAnB,OAAA,EAAzBA,EAA2B7B,QAE3BA,GACfuB,EAAG,iBACI,MAGFzB,EAAAA,cAAAA,EAAAA,SAAA,KAAGgC,EACZ,C","sources":["webpack://gatsby-starter-minimal-ts/./src/pages/test/route/member.tsx","webpack://gatsby-starter-minimal-ts/./src/database/routerViteGatsbyUniversal.ts","webpack://gatsby-starter-minimal-ts/./src/components/ppm/supabase-react-role-access-automator/RoleRoutesJWT.tsx"],"sourcesContent":["\n\n\nimport React from \"react\";\nimport RoleRoutesJWT from \"../../../components/ppm/supabase-react-role-access-automator/RoleRoutesJWT\";\n\nexport default () => <>\n\n\n    <RoleRoutesJWT role=\"admin\" redirect=\"../../../test/login\" >\n        members only\n    </RoleRoutesJWT>\n\n</>","// @ppm-template:role-based-auth\n// @ppm-version:2.0 // (was throwing error in gatsby)\n\nimport { useEffect, useRef } from \"react\";\n\ntype RouteList = any[];\n\nexport function useUniversalRouter() {\n  const routesRef = useRef<RouteList | null>(null);\n  const gatsbyNavigateRef = useRef<((to: string) => void) | null>(null);\n  const initializedRef = useRef(false);\n\n  useEffect(() => {\n    if (initializedRef.current || typeof window === \"undefined\") return;\n    initializedRef.current = true;\n\n    (async () => {\n      // ---------- 1) GATSBY DETECTION ----------\n      try {\n        const gatsbyModuleName = \"gatsby\";\n        // eslint-disable-next-line no-eval\n        const gatsby = await eval(`import(${JSON.stringify(gatsbyModuleName)})`);\n\n        if (typeof gatsby.navigate === \"function\") {\n          gatsbyNavigateRef.current = gatsby.navigate;\n          return; // <-- IMPORTANT: stop here in Gatsby\n        }\n      } catch {\n        // not Gatsby, keep going\n      }\n\n      // ---------- 2) VITE ONLY (hidden from Gatsbyâ€™s brain) ----------\n      const isVite =\n        // @ts-ignore\n        typeof window !== \"undefined\" &&\n        !!(window as any).__vite_plugin_react_preamble_installed__;\n\n      if (!isVite) return; // Gatsby exits cleanly here\n\n      try {\n        const virtualName = \"virtual:\" + \"generated-pages-react\";\n        // eslint-disable-next-line no-eval\n        const mod = await eval(`import(${JSON.stringify(virtualName)})`);\n        routesRef.current = mod.default;\n      } catch {\n        // truly not Vite, nothing to do\n      }\n    })();\n  }, []);\n\n  const go = (to: string) => {\n    if (gatsbyNavigateRef.current) {\n      gatsbyNavigateRef.current(to);\n      return;\n    }\n    window.location.assign(to);\n  };\n\n  const getRoutes = () => routesRef.current;\n\n  return { go, getRoutes };\n}","\n// @ppm-template-prototype\n\nimport React, { useEffect, useState } from \"react\";\nimport { supabase } from \"../../../database/supabase\";\nimport { useUniversalRouter } from \"../../../database/routerViteGatsbyUniversal\";\n\ntype Props = {\n  role: string;\n  children: React.ReactNode;\n};\n\nexport default function RoleRoutesJWT({ role, children }: Props) {\n  const [session, setSession] = useState<any>(null);\n  const [loading, setLoading] = useState(true);\n\n  const { go } = useUniversalRouter()\n\n  useEffect(() => {\n    let mounted = true;\n\n    // 1ï¸âƒ£ get initial session\n    supabase.auth.getSession().then(({ data }) => {\n      if (!mounted) return;\n      setSession(data.session);\n      setLoading(false);\n    });\n\n    // 2ï¸âƒ£ listen for changes (refresh, login, logout)\n    const {\n      data: { subscription },\n    } = supabase.auth.onAuthStateChange((_event, session) => {\n      if (!mounted) return;\n      setSession(session);\n    });\n\n    return () => {\n      mounted = false;\n      subscription.unsubscribe();\n    };\n  }, []);\n\n  // ðŸ”‘ THE FIX: wait for hydration\n  if (loading) return null;\n\n  // your original behavior â€” untouched\n  if (!session?.user) {\n    go(\"/login\");\n    return null;\n  }\n\n  const userRole = session.user.app_metadata?.role;\n\n  if (userRole !== role) {\n    go(\"/unauthorized\");\n    return null;\n  }\n\n  return <>{children}</>;\n}\n"],"names":["React","RoleRoutesJWT","role","redirect","useUniversalRouter","routesRef","useRef","gatsbyNavigateRef","initializedRef","useEffect","current","window","gatsbyModuleName","gatsby","eval","JSON","stringify","navigate","_unused","isVite","__vite_plugin_react_preamble_installed__","virtualName","mod","default","_unused2","go","to","location","assign","getRoutes","_ref","_session$user$app_met","children","session","setSession","useState","loading","setLoading","mounted","supabase","auth","getSession","then","_ref2","data","subscription","onAuthStateChange","_event","unsubscribe","user","app_metadata"],"sourceRoot":""}